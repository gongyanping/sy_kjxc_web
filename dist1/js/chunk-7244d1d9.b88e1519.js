(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7244d1d9"],{"129f":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},"1c33":function(t,e,a){},"1e89":function(t,e,a){"use strict";var n=a("2cd7");a.n(n).a},2626:function(t,e,a){"use strict";var n=a("d066"),i=a("9bf2"),o=a("b622"),r=a("83ab"),s=o("species");t.exports=function(t){var e=n(t),a=i.f;r&&e&&!e[s]&&a(e,s,{configurable:!0,get:function(){return this}})}},"2cd7":function(t,e,a){},"3bbe":function(t,e,a){var n=a("861d");t.exports=function(t){if(!n(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},"3fe7":function(t,e,a){},"44e7":function(t,e,a){var n=a("861d"),i=a("c6b6"),o=a("b622")("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[o])?!!e:"RegExp"==i(t))}},"466d":function(t,e,a){"use strict";var n=a("d784"),i=a("825a"),o=a("50c4"),r=a("1d80"),s=a("8aa5"),l=a("14c3");n("match",1,(function(t,e,a){return[function(e){var a=r(this),n=null==e?void 0:e[t];return void 0!==n?n.call(e,a):new RegExp(e)[t](String(a))},function(t){var n=a(e,t,this);if(n.done)return n.value;var r=i(t),c=String(this);if(!r.global)return l(r,c);for(var p,u=r.unicode,d=[],m=r.lastIndex=0;null!==(p=l(r,c));){var f=String(p[0]);""===(d[m]=f)&&(r.lastIndex=s(c,o(r.lastIndex),u)),m++}return 0===m?null:d}]}))},"4d63":function(t,e,a){var n=a("83ab"),i=a("da84"),o=a("94ca"),r=a("7156"),s=a("9bf2").f,l=a("241c").f,c=a("44e7"),p=a("ad6d"),u=a("9f7f"),d=a("6eeb"),m=a("d039"),f=a("69f3").set,h=a("2626"),g=a("b622")("match"),b=i.RegExp,v=b.prototype,y=/a/g,k=/a/g,w=new b(y)!==y,C=u.UNSUPPORTED_Y;if(n&&o("RegExp",!w||C||m((function(){return k[g]=!1,b(y)!=y||b(k)==k||"/a/i"!=b(y,"i")})))){function x(t){t in O||s(O,t,{configurable:!0,get:function(){return b[t]},set:function(e){b[t]=e}})}for(var O=function(t,e){var a,n=this instanceof O,i=c(t),o=void 0===e;if(!n&&i&&t.constructor===O&&o)return t;w?i&&!o&&(t=t.source):t instanceof O&&(o&&(e=p.call(t)),t=t.source),C&&(a=!!e&&-1<e.indexOf("y"))&&(e=e.replace(/y/g,""));var s=r(w?new b(t,e):b(t,e),n?this:v,O);return C&&a&&f(s,{sticky:a}),s},S=l(b),P=0;S.length>P;)x(S[P++]);(v.constructor=O).prototype=v,d(i,"RegExp",O)}h("RegExp")},"617e":function(t,e,a){"use strict";var n=a("c4bd");a.n(n).a},7156:function(t,e,a){var n=a("861d"),i=a("d2bb");t.exports=function(t,e,a){var o,r;return i&&"function"==typeof(o=e.constructor)&&o!==a&&n(r=o.prototype)&&r!==a.prototype&&i(t,r),t}},"71e9":function(t,e,a){"use strict";a.r(e),a("a4d3"),a("4de4"),a("4160"),a("d81d"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("4d63"),a("ac1f"),a("25f0"),a("466d"),a("841c"),a("159b");var n=a("2fa7"),i={props:{tabledatas:{type:Object,default:function(){return{total:0,pageNum:1,pageSize:10}}}},methods:{handleSizeChange:function(t){this.$emit("comgetData",t,1)},handleCurrentChange:function(t){this.$emit("comgetData",t)}}},o=(a("617e"),a("2877")),r=Object(o.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.tabledatas&&t.tabledatas.total?a("div",{staticClass:"comm-table-flooter"},[a("el-pagination",{attrs:{layout:"total, sizes, prev, pager, next",background:"","page-sizes":t.$store.state.pageSizes,"current-page":t.tabledatas.pageNum,"page-size":t.tabledatas.pageSize,total:t.tabledatas.total,"hide-on-single-page":!1},on:{"current-change":t.handleCurrentChange,"size-change":t.handleSizeChange,"update:currentPage":function(e){return t.$set(t.tabledatas,"pageNum",e)},"update:current-page":function(e){return t.$set(t.tabledatas,"pageNum",e)}}})],1):t._e()}),[],!1,null,"47815342",null).exports,s=a("6a2b"),l={name:"patrolpoint-list",props:["datatables"],methods:{handleLocate:function(t){var e=t.id,a=t.lon,n=t.lat;this.$emit("handleLocate",e,a,n)},handleEdit:function(t){this.$emit("handleEdit",t)},handleCopy:function(t){var e=this;this.$confirm("是否复制出一个该巡逻点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((function(){delete t.id,e.$emit("onSavePoint",t)})).catch((function(){e.$message.info("已取消复制")}))},onDelete:function(t,e){var a=this,n=1<arguments.length&&void 0!==e?e:"该";this.$confirm("是否删除"+n+"巡逻点?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((function(){var e=a.$qs.stringify({id:t});a.$api.patrolPoint.delete(e).then((function(){a.$message.success("删除成功"),a.$emit("getList")}))})).catch((function(){a.$message.info("已取消删除")}))}}},c=(a("e0c5"),Object(o.a)(l,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"patrolpointList"},t._l(t.datatables,(function(e,n){return a("li",{key:n},[a("div",[a("p",{staticClass:"name",on:{click:function(a){return t.handleLocate(e)}}},[a("i",{staticClass:"el-icon-location-information location-icon"}),t._v(" "+t._s(e.name)+" ")]),a("p",{staticClass:"time"},[t._v("时间："+t._s(e.createTime))]),a("p",{staticClass:"ellipsis"},[t._v("地址："+t._s(e.address))])]),a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{staticClass:"bt-edit",attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handleEdit(e)}}},[t._v("编辑")]),a("p",{staticStyle:{"margin-top":"5px"}},[a("el-button",{staticClass:"bt-edit",attrs:{type:"primary",size:"mini",plain:""},on:{click:function(a){return t.handleCopy(e)}}},[t._v("复制")])],1)],1),a("i",{staticClass:"el-icon-close delIcon",on:{click:function(a){return t.onDelete(e.id,e.name)}}})])})),0)}),[],!1,null,"1df4b23c",null).exports),p={name:"patrolpoint-dialog",props:["dialogVisible","curId","form","typeOptions","isFromTask"],data:function(){return{visible:!1,pointId:"",rules:{name:[{required:!0,message:"请输入点位名称",trigger:"blur"}]},patrolForm:{},lineOptions:[]}},watch:{dialogVisible:function(t){this.visible=t},curId:function(t){this.pointId=t,this.visible&&this.pointId&&this.initData()}},created:function(){this.findAll(),this.patrolForm=this.form},methods:{findAll:function(){var t=this;this.$api.patrolPoint.findAll().then((function(e){t.lineOptions=e.data.data}))},initData:function(){var t=this;this.$api.patrolPoint.getOne(this.$qs.stringify({id:this.pointId})).then((function(e){t.patrolForm=e.data.data}))},onSavePoint:function(){var t=this;this.$refs.patrolForm.validate((function(e){if(!e)return!1;var a=t.$qs.stringify(t.patrolForm);t.$api.patrolPoint.saveOrUpdate(a).then((function(e){0===e.data.code&&(t.$message.success((t.curId?"修改":"新增")+"巡逻点成功"),t.$emit("getList")),t.onCancelPoint()}))}))},onCancelPoint:function(){this.visible=!1,this.$emit("closeDialog"),this.$refs.patrolForm.resetFields()}}},u=Object(o.a)(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"patrolpointDialog"},[a("el-dialog",{attrs:{title:"请选择点位类型",visible:t.visible,width:"35%"},on:{"update:visible":function(e){t.visible=e},close:t.onCancelPoint}},[a("el-form",{ref:"patrolForm",attrs:{model:t.patrolForm,"label-width":"120px",rules:t.rules}},[a("el-form-item",{attrs:{label:"任务名称",prop:"lineId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择任务列表",clearable:"",disabled:t.isFromTask},model:{value:t.patrolForm.lineId,callback:function(e){t.$set(t.patrolForm,"lineId",e)},expression:"patrolForm.lineId"}},[a("el-option",{key:"uniqued0000",attrs:{label:"未知",value:""}}),t._l(t.lineOptions,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1),a("el-form-item",{attrs:{label:"点位名称",prop:"name"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入点位名称",clearable:""},model:{value:t.patrolForm.name,callback:function(e){t.$set(t.patrolForm,"name",e)},expression:"patrolForm.name"}})],1),a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"地址",clearable:"",disabled:""},model:{value:t.patrolForm.address,callback:function(e){t.$set(t.patrolForm,"address",e)},expression:"patrolForm.address"}})],1),a("el-form-item",{attrs:{label:"坐标",prop:"lon"}},[a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:3}},[t._v("经度")]),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{disabled:""},model:{value:t.patrolForm.lon,callback:function(e){t.$set(t.patrolForm,"lon",e)},expression:"patrolForm.lon"}})],1),a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:2}},[t._v("-")]),a("el-col",{staticClass:"line",staticStyle:{"text-align":"center"},attrs:{span:3}},[t._v("维度")]),a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{disabled:""},model:{value:t.patrolForm.lat,callback:function(e){t.$set(t.patrolForm,"lat",e)},expression:"patrolForm.lat"}})],1)],1),a("el-form-item",{attrs:{label:"点位类型",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择点位类型",clearable:""},model:{value:t.patrolForm.type,callback:function(e){t.$set(t.patrolForm,"type",e)},expression:"patrolForm.type"}},t._l(t.typeOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),"1"!==t.patrolForm.type?a("el-form-item",{attrs:{label:"时间",prop:"time"}},[a("el-time-picker",{attrs:{format:"HH:mm","value-format":"HH:mm",placeholder:"请选择时间点"},model:{value:t.patrolForm.time,callback:function(e){t.$set(t.patrolForm,"time",e)},expression:"patrolForm.time"}})],1):t._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.onCancelPoint}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSavePoint}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,null,null).exports,d=a("bd0c");function m(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?m(a,!0).forEach((function(e){Object(n.a)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):m(a).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var h={name:"patrol-point",components:{Pagination:r,noData:s.a,patrolpointList:c,patrolpointDialog:u,BmlMarkerClusterer:d.BmlMarkerClusterer,BmMarker:d.BmMarker},data:function(){return{center:{lng:111.28,lat:27.14},zoom:12,tableDatas:{pageNum:1,pageSize:10,total:100,rows:[]},dialogVisible:!1,curId:"",inputName:"",typeName:"",typeOptions:[{label:"巡逻点位",value:"1"},{label:"上班",value:"2"},{label:"下班",value:"3"}],markers:[],form:{pageNumber:1,pageSize:6},selectedAddr:"",onProcessing:!1,infoWindow:{show:!1,contents:""},markerCoord:null,BMap:null,patrolForm:{id:"",name:"",address:"",lon:"",lat:"",lineId:"",type:"1",time:""},isFromTask:!1,lineId:""}},created:function(){var t=this.GetQueryString("lineId");t&&(this.lineId=t,this.isFromTask=!0),this.getList()},methods:{handler:function(t){var e=t.BMap;this.BMap=e},mapInit:function(){this.zoom=12,this.center={lng:111.28,lat:27.14}},getList:function(t,e){var a=this,n=0<arguments.length&&void 0!==t?t:1;(1<arguments.length?e:void 0)?(this.form.pageNumber=1,this.form.pageSize=n):this.form.pageNumber=n,this.mapInit(),this.$api.patrolPoint.list(this.$qs.stringify(f({},this.form,{name:this.inputName,type:this.typeName,lineId:""}))).then((function(t){0===t.data.code&&(a.tableDatas=f({},t.data.data,{pageNum:a.form.pageNumber,pageSize:a.form.pageSize}),a.markers=t.data.data.rows.map((function(t){return{id:t.id,name:t.name,lng:t.lon,lat:t.lat,isLocate:!1}})),a.markersLength=a.markers.length)})).catch((function(t){}))},handleNew:function(){this.onProcessing?(this.curId="",this.dialogVisible=!0,this.lineId&&(this.isFromTask=!0,this.patrolForm.lineId=this.lineId)):this.onProcessing=!0},handleEdit:function(t){this.dialogVisible=!0,this.curId=t?t.id:""},handleLocate:function(t,e,a){e&&a?(this.center={lng:e,lat:a},this.zoom=18,this.markers=this.markers.map((function(e){return e.id===t?e.isLocate=!0:e.isLocate=!1,e}))):this.$message.info("该坐标位置不存在")},closeDialog:function(){this.curId="",this.dialogVisible=!1,this.onProcessing=!1,this.patrolForm={id:"",name:"",address:"",lon:"",lat:"",lineId:"",type:"1",time:""}},onMapClick:function(t){var e=this,a=t.point,n=a.lng,i=a.lat;this.onProcessing&&(this.patrolForm.lon=n,this.patrolForm.lat=i,this.markers.length>this.markersLength&&this.markers.pop(),this.markers.push({lng:n,lat:i}),(new this.BMap.Geocoder).getLocation(t.point,(function(t){e.patrolForm.address=t.address})))},onMarkerClick:function(t){var e=t.name,a=t.lng,n=t.lat;this.markerCoord={lng:a,lat:n},this.infoWindow={show:!0,title:e,contents:"坐标:"+a+","+n}},infoWindowClose:function(){this.infoWindow.show=!1},infoWindowOpen:function(){this.infoWindow.show=!0},onSavePoint:function(t){var e=this;this.$api.patrolPoint.saveOrUpdate(this.$qs.stringify(t)).then((function(t){0===t.data.code&&(e.$message.success("复制巡逻点成功"),e.getList())}))},onCancelPoint:function(){this.dialogVisible=!1,this.onProcessing=!1},reset:function(){this.inputName="",this.typeName=""},handleCancelPoint:function(){this.onProcessing=!1,this.markers.length>this.markersLength&&this.markers.pop()},GetQueryString:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(e);return null!==a?unescape(a[2]):null}}},g=(a("1e89"),a("b162"),Object(o.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"patrolmainWrap"},[n("div",{staticClass:"patrolHeader"},[n("div",[n("el-button",{attrs:{type:"primary",size:"small",disabled:t.onProcessing&&!this.patrolForm.lon},on:{click:t.handleNew}},[t.onProcessing?n("span",[t._v("确定巡逻点")]):n("span",[t._v("新增巡逻点")])]),t.onProcessing?n("el-button",{attrs:{size:"small"},on:{click:t.handleCancelPoint}},[t._v("取消新增巡逻点")]):t._e(),n("span",{staticClass:"elAlert"},[t.onProcessing?n("el-alert",{attrs:{title:"请先在地图上选择点位信息，再点击确定巡逻点按钮去进行巡逻点的新增",type:"success"}}):t._e()],1)],1),n("div",{staticClass:"searchWrap"},[n("el-input",{staticStyle:{width:"2rem"},attrs:{placeholder:"请输入关键字",size:"small",clearable:""},model:{value:t.inputName,callback:function(e){t.inputName=e},expression:"inputName"}}),n("el-select",{staticStyle:{width:"2rem","margin-left":"0.1rem"},attrs:{placeholder:"请选择点位类型",size:"small",clearable:""},model:{value:t.typeName,callback:function(e){t.typeName=e},expression:"typeName"}},t._l(t.typeOptions,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1),n("el-button",{staticClass:"bt-search",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.getList(1)}}},[t._v("搜索")]),n("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:t.reset}},[t._v("重置")])],1)]),n("div",{staticClass:"mainWrap"},[n("baidu-map",{staticClass:"map",attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0},on:{ready:t.handler,click:t.onMapClick}},[n("bml-marker-clusterer",{attrs:{averageCenter:!0}},t._l(t.markers,(function(e){return n("bm-marker",{key:e.id,attrs:{position:{lng:e.lng,lat:e.lat},icon:e.isLocate?{url:a("e89d"),size:{width:32,height:32}}:{url:a("9925"),size:{width:32,height:32}}},on:{click:function(a){return t.onMarkerClick(e)}}})})),1),n("bm-info-window",{attrs:{position:t.markerCoord,title:t.infoWindow.title,show:t.infoWindow.show},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[n("p",{domProps:{textContent:t._s(t.infoWindow.contents)}})])],1),n("div",{staticClass:"listWrap"},[n("patrolpoint-list",{attrs:{datatables:t.tableDatas&&t.tableDatas.rows},on:{handleLocate:t.handleLocate,handleEdit:t.handleEdit,getList:t.getList,onSavePoint:t.onSavePoint}}),n("Pagination",{attrs:{tabledatas:t.tableDatas},on:{comgetData:t.getList}}),t.tableDatas.rows.length<=0?n("no-data"):t._e()],1)],1),n("patrolpoint-dialog",{attrs:{dialogVisible:t.dialogVisible,curId:t.curId,form:t.patrolForm,typeOptions:t.typeOptions,isFromTask:t.isFromTask},on:{closeDialog:t.closeDialog,getList:t.getList}})],1)}),[],!1,null,"4a624395",null));e.default=g.exports},"841c":function(t,e,a){"use strict";var n=a("d784"),i=a("825a"),o=a("1d80"),r=a("129f"),s=a("14c3");n("search",1,(function(t,e,a){return[function(e){var a=o(this),n=null==e?void 0:e[t];return void 0!==n?n.call(e,a):new RegExp(e)[t](String(a))},function(t){var n=a(e,t,this);if(n.done)return n.value;var o=i(t),l=String(this),c=o.lastIndex;r(c,0)||(o.lastIndex=0);var p=s(o,l);return r(o.lastIndex,c)||(o.lastIndex=c),null===p?-1:p.index}]}))},9925:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACO0lEQVRYR81XQXLTQBCcsSPlBPGRKiLjXIh0wj/AeUGSFxBeEHgB5gfwgjgviPOCmB+YkwyXqKRQxdEOJ7Sxm9pgFQ5a7a5sqSpbpYu0M93qmZ2ZZSqxvj93umjyIYAeMXeISD5yRQREzDziOS5f/hBjW7dsszH0nBNm/rACaDKLmNDfj8W5aaOWwHWLWr+fuGfEdGRypPrOwMD9Jd7vTWlaZF9I4B78qXNFxN11wP/ZYLx9Kw6KSBQSmHjukJgONwNfWoOGfpIeK1VSvVzG/KwS8IwD8DZIxOB/n0oFwrYbMdGLKgnIk+LH6Z6RQLi71eNG46pi8Ht3WCwOgpu70arvnAKTXecTNfi0DgK0wGf/RrzTEgg9Z8TMr+sgAOBLkIienkA98c8wc3mQD0HbRR1/n/n04/QB5uMjUNMR/CsA8NVPxIPKmlMg9JwBM7+pIwwAzoNEnJhOgex8lVbBDBCKaqishJO2MyXinWpVwMyPRctYCeWGsO32mUj2/8oWiD4Gcdq3I/CMOuy615WhE2ZIRTf4SZEVgapVKPp7iWMaSKLNcwGz7VvRKT2QSHbfvOYRuHmxSSgY8+P9ZD4s8mEcSjeajECXfpJq50kjgeVsuEYo9NJnihgJrBsKk/SlCMjNpQYVxeCxdg6sGk48Z0zMr7RJqWg4uv1WIcgcmPPBLu7aZmQ6cvJ+uGjSKF8fMGvMqVfmXqgtRDoiqvpgm3TWpdikxOrlRdVmTfalT4HKoSQh36tuPLYE/gBrb+8hqW7FhAAAAABJRU5ErkJggg=="},b0c0:function(t,e,a){var n=a("83ab"),i=a("9bf2").f,o=Function.prototype,r=o.toString,s=/^\s*function ([^ (]*)/;!n||"name"in o||i(o,"name",{configurable:!0,get:function(){try{return r.call(this).match(s)[1]}catch(t){return""}}})},b162:function(t,e,a){"use strict";var n=a("3fe7");a.n(n).a},c4bd:function(t,e,a){},d2bb:function(t,e,a){var n=a("825a"),i=a("3bbe");t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,a={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(a,[]),e=a instanceof Array}catch(a){}return function(a,o){return n(a),i(o),e?t.call(a,o):a.__proto__=o,a}}():void 0)},e0c5:function(t,e,a){"use strict";var n=a("1c33");a.n(n).a}}]);